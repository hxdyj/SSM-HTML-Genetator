<!DOCTYPE html>
<html>

<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <!-- Site Properties -->
    <title>Login Example - Semantic</title>
    <link rel="stylesheet" type="text/css" href="./bower_components/semantic/dist/semantic.min.css">
    <script src="./bower_components/jquery/dist/jquery.min.js"></script>

    <script src="./js/config.js"></script>
    <script src="./bower_components/lodash/dist/lodash.min.js"></script>
    <script src="./bower_components/semantic/dist/semantic.min.js"></script>
    <script src="./bower_components/vue/dist/vue.min.js"></script>

    <style type="text/css">
        Â· body>.grid {
            height: 100%;
        }

        .image {
            margin-top: -100px;
        }

        .column {
            max-width: 450px;
        }
    </style>

</head>

<body style="background: #5AB9E0 !important;">

    <div id="app" style="padding:30px;">
        <div style="display: flex;justify-content: center;flex-direction: column;align-items: center">

            <h2 class="ui header">Subtitle Management</h2>
            <div class="ui search">
                <div class="ui icon input">
                    <input class="prompt" v-model="searchStr" type="text" placeholder="subtitle content search...">
                    <span @click="search()" style="position: relative;left:-30px;top:10px">
                        <i class="search icon"></i>
                    </span>
                </div>
            </div>

        </div>
        <div style="display: flex;justify-content: flex-end">
            <button class="ui olive right button" @click="addModal()" style="margin-top:10px">
                Add Subtitle
            </button>
        </div>

        <table class="ui blue table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>PlayId</th>
                    <th>Content</th>
                    <th>Time</th>
                    <th>Language</th>
                    <th>ContentId</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="item in list">
                    <td>{{item.id}}</td>
                    <td>{{item.playId}}</td>
                    <td>{{item.content}}</td>
                    <td>{{item.time}}</td>
                    <td>{{item.language}}</td>
                    <td>{{item.contentId}}</td>
                    <td>
                        <div class="ui small basic icon buttons">
                            <button class="ui button">
                                <i class="edit icon" @click="edit(item)"></i>
                            </button>
                            <button class="ui button">
                                <i class="trash icon" @click="del(item.id)"></i>
                            </button>

                        </div>
                    </td>
                </tr>

            </tbody>
        </table>
        <div style="display: flex;justify-content: center">

            <div class="ui small basic icon buttons">
                <button class="ui button" @click="changePage(1)">First</button>
                <button class="ui button" @click="changePage(app.page-1)">Pre</button>
                <button class="ui button" disabled>{{app.page}}/{{app.users.length}}</button>
                <button class="ui button" @click="changePage(app.page+1)">Next</button>
                <button class="ui button" @click="changePage(app.users.length)">End</button>
            </div>
        </div>
        <div class="ui modal user" style="padding:30px">
            <h3>Edit Subtitle</h3>
            <div class="ui form">
                <div class="field">
                    <label>PlayId</label>
                    <input type="text" name="first-name" v-model="up.playId" placeholder="PlayId">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="up.content" placeholder="Content">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="up.time" placeholder="Time">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="up.language" placeholder="Language">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="up.contentId" placeholder="ContentId">
                </div>
                <button class="ui button" @click="update()">Edit</button>
            </div>
        </div>
        <div class="ui modal add" style="padding:30px">
            <h3>Add Subtitle</h3>
            <div class="ui form">
                <div class="field">
                    <label>PlayId</label>
                    <input type="text" name="first-name" v-model="add.playId" placeholder="PlayId">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="add.content" placeholder="Content">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="add.time" placeholder="Time">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="add.language" placeholder="Language">
                </div>
                <div class="field">
                    <label></label>
                    <input type="text" name="first-name" v-model="add.contentId" placeholder="ContentId">
                </div>

                <button class="ui button" @click="addSubmit()">Add</button>
            </div>
        </div>
    </div>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                username: null,
                password: null,
                all: [],
                users: [],
                list: [],
                page: 1,
                searchStr: '',
                up: {
                    id: -1,
                    playId: '',
                    content: '',
                    time: '',
                    language: '',
                    contentId: '',
                },
                add: {
                    playId: '',
                    content: '',
                    time: '',
                    language: '',
                    contentId: '',
                }
            },
            methods: {
                getUsers() {
                    fetch(server + 'sub/all.do').then(resp => {
                        resp.json().then(data => {
                            app.all = data
                            app.users = _.chunk(data, 10)
                            app.list = app.users[app.page - 1]
                            console.log(data)
                        })
                    })
                },
                changePage(page) {
                    if (page > 0 && page < app.users.length + 1) {
                        app.page = page
                        app.list = app.users[app.page - 1]
                    }
                },
                del(id) {
                    let data = new FormData()
                    data.append('id', id)
                    fetch(server + 'sub/del.do', {
                        method: 'POST',
                        body: data
                    }).then(resp => {

                        app.getUsers()
                        alert("delete success")
                    })
                },
                search() {
                    if (app.searchStr) {
                        let tmp = _.filter(app.all, item => item.content.search(app.searchStr) != -1)
                        app.users = _.chunk(tmp, 10)
                        app.list = app.users[app.page - 1]
                    } else {
                        app.users = _.chunk(app.all, 10)
                        app.list = app.users[app.page - 1]
                    }
                },
                edit(item) {
                    app.up = {
                        id: item.id,
                        playId: item.playId,
                        content: item.content,
                        time: item.time,
                        language: item.language,
                        contentId: item.contentId,
                    }

                    $('.ui.modal.user').modal('show')
                },
                addModal() {
                    app.add =
                        {
                            playId: '',
                            content: '',
                            time: '',
                            language: '',
                            contentId: '',
                        }
                    $('.ui.modal.add').modal('show')
                },
                addSubmit() {
                    let data = new FormData()
                    data.append('playId', app.add.playId)
                    data.append('content', app.add.content)
                    data.append('time', app.add.time)
                    data.append('language', app.add.language)
                    data.append('contentId', app.add.contentId)
                    fetch(server + 'sub/add.do', {
                        method: 'POST', body: data
                    }).then(resp => {
                        resp.text().then(data => {
                            app.getUsers()
                            $('.ui.modal.add').modal('hide')
                            alert("add success")
                        })
                    })
                },
                update() {
                    let data = new FormData()
                    data.append('id', app.up.id)
                    data.append('playId', app.add.playId)
                    data.append('content', app.add.content)
                    data.append('time', app.add.time)
                    data.append('language', app.add.language)
                    data.append('contentId', app.add.contentId)
                    fetch(server + 'sub/update.do', {
                        method: 'POST'
                        , body: data
                    }).then(resp => {
                        resp.text().then(data => {
                            app.getUsers()
                            $('.ui.modal.user').modal('hide')
                            alert("edit success")
                        })
                    })
                }
            }
        })

        app.getUsers()
    </script>
</body>

</html>